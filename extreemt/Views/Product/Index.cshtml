@{
    ViewBag.Title = "Products";
    Layout = "~/Views/Shared/_LoginLayout.cshtml";
}

﻿@model IEnumerable<extreemt.product>
@{
    if (!extreemt.tools.isAuthorized(Request.Url.AbsolutePath))
    {
        if (Request.Url.AbsolutePath != Url.Action("Index", "Home"))
        {
            Response.Redirect(Url.Action("Index", "Home"));
            return;
        }
    }
}




<h2>
    @{
        extreemt.user usr = extreemt.Account.staticGetLoggedUser();
        if (extreemt.Account.isAdmin(usr))
        {
            @Html.ActionLink("Create New", "Create")
        }
    }

</h2>
<!--
<table>
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.description)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.count)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.date)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.price)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.category.name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.user.username)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.name)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.description)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.count)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.date)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.price)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.category.name)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.user.username)
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.id }) |
            @Html.ActionLink("Details", "Details", new { id=item.id }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.id })
        </td>
    </tr>
}

</table>
-->

<div class="container">


    <div class="row">
        <div class="col-md-3">
            <ul class="nav nav-pills nav-stacked">
                @{
                    if (ViewBag.categoryId == 0)
                    {
                        <li class="active"><a href="@Url.Action("Index", "Product", new { id = 0})">All</a></li>
                    }
                    else
                    {
                        <li><a href="@Url.Action("Index", "Product", new { id = 0 })">All</a></li>
                    }
                    extreemt.extreemtEntities db = new extreemt.extreemtEntities();

                    foreach (extreemt.category cat in db.categories)
                    {
                        if (cat.id == ViewBag.categoryId)
                        {
                            <li class="active"><a href="@Url.Action("Index", "Product", new { id=cat.id})">@cat.name</a></li>
                        }
                        else
                        {
                            <li><a href="@Url.Action("Index", "Product", new { id=cat.id})">@cat.name</a></li>
                        }
                    }
                }

            </ul>
        </div>
        <div class="col-md-9">



            @{
                int j = 0;
            }
            @foreach (var item in Model)
            {

                if (j % 3 == 0)
                {

                    Response.Write("<div class='row'>");
                }

                <div class="col-md-4 bottom-cd simpleCart_shelfItem" style="">
                    <div class="product-at ">
                        <a href="@Url.Action("Details", "Product", new { id = item.id })">
                            @{
                if (item.photos.Count > 0)
                {
                    string str = item.photos.First().photo1;

                    <img class="img-responsive" src="~/Upload/@str" style="height:210px;width:100%" alt="">
                }
                else
                {
                    <img class="img-responsive" src="~/Content/images/product.jpg" style="height:210px;" alt="">

                }
                            }

                            <div class="pro-grid" style="text-align:center">
                                <span class="buy-in">@Html.DisplayFor(modelItem => item.name)</span>
                            </div>

                            @{
                if (item.count > 0)
                {
                    <div class="pro-grid" style="text-align:right">
                        <span class="buy-in">Available</span>
                    </div>
                }
                else
                {
                    <div class="pro-grid" style="text-align:right">
                        <span class="buy-in">Not Available</span>
                    </div>
                }
                            }



                        </a>
                        @{
                if (extreemt.Account.isAdmin(usr))
                {
                    <div class="pro-grid">
                        <span class="buy-in">@Html.ActionLink("Edit", "Edit", new { id = item.id })</span>
                    </div>
                            <div class="pro-grid">
                                <span class="buy-in">@Html.ActionLink("Delete", "Delete", new { id = item.id })</span>
                            </div>
                }
                        }


                    </div>
                    <a href="@Url.Action("Details", "Product", new { id = item.id })" class="item_add"><p class="number item_price"><i> </i>EGP @Html.DisplayFor(modelItem => item.price)</p></a>
                </div>
                if (j % 3 == 0)
                {
                    Response.Write("</div>");
                }
                j++;

            }


        </div>


    </div>
    <div class="row">
        <ul class="pagination">
            @{
                int numOfPages = (int)ViewData["numOfPages"];
                for (int i = 1; i <= numOfPages; i++)
                {
                    int page = 1;
                    if (Request.Params["page"] != null && Request.Params["page"] != "")
                    {
                        page = int.Parse(Request.Params["page"]);
                    }
                    string url = Request.Url.GetLeftPart(UriPartial.Path);
                    url += "?page=" + i;
                    if (i == page)
                    {
                        <li class="active"><a href="@url">@i</a></li>
                    }
                    else
                    {
                        <li><a href="@url">@i</a></li>
                    }
                }
            }

        </ul>
    </div>

</div>
